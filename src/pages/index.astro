---
import Base from "../layouts/Base.astro";
import Hero from "../components/Hero.astro";
import SectionHeader from "../components/SectionHeader.astro";
import BlogCard from "../components/BlogCard.astro";
import ProjectCard from "../components/ProjectCard.astro";
import NoteEntry from "../components/NoteEntry.astro";
import { getCollection } from "astro:content";

const allPosts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const recentPosts = allPosts.slice(0, 4);

const allNotes = (await getCollection("notes"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const recentNotes = allNotes.slice(0, 5);

const featuredProjects = (await getCollection("projects"))
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.order - b.data.order);
---

<Base title="Home">
  <Hero />

  <div class="home-content">
    <!-- Recent Posts -->
    <section class="home-section animate-fade-in-up" style="animation-delay: 0.1s;">
      <SectionHeader title="Recent Posts" href="/blog" />
      <div class="posts-grid">
        {recentPosts.map((post) => (
          <BlogCard
            title={post.data.title}
            description={post.data.description}
            date={post.data.date}
            tags={post.data.tags}
            slug={post.id}
          />
        ))}
      </div>
    </section>

    <!-- Projects -->
    {featuredProjects.length > 0 && (
      <section class="home-section animate-fade-in-up" style="animation-delay: 0.2s;">
        <SectionHeader title="Projects" href="/projects" />
        <div class="projects-grid">
          {featuredProjects.map((project) => (
            <ProjectCard
              title={project.data.title}
              description={project.data.description}
              tags={project.data.tags}
              slug={project.id}
            />
          ))}
        </div>
      </section>
    )}

    <!-- Notes -->
    {recentNotes.length > 0 && (
      <section class="home-section animate-fade-in-up" style="animation-delay: 0.3s;">
        <SectionHeader title="Notes" href="/notes" />
        <div class="notes-list">
          {recentNotes.map((note) => (
            <NoteEntry
              title={note.data.title}
              description={note.data.description}
              date={note.data.date}
              id={note.id}
            />
          ))}
        </div>
      </section>
    )}
  </div>
</Base>

<style>
  .home-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1.5rem 4rem;
  }

  .home-section {
    margin-bottom: 4rem;
  }

  .posts-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .notes-list {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    padding: 0.5rem 1.25rem;
  }
</style>
