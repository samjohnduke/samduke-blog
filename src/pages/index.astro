---
import Base from "../layouts/Base.astro";
import Hero from "../components/Hero.astro";
import SectionHeader from "../components/SectionHeader.astro";
import BlogCard from "../components/BlogCard.astro";
import ProjectCard from "../components/ProjectCard.astro";
import NoteEntry from "../components/NoteEntry.astro";
import { getCollection } from "astro:content";

const allPosts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const recentPosts = allPosts.slice(0, 4);

const allNotes = (await getCollection("notes"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const recentNotes = allNotes.slice(0, 5);

const featuredProjects = (await getCollection("projects"))
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.order - b.data.order);
---

<Base title="Home">
  <Hero />

  <div class="home-content">
    <!-- Recent Writing -->
    <section class="home-section animate-fade-in-up" style="animation-delay: 0.1s;">
      <SectionHeader title="Recent Writing" kanji="随筆" href="/blog" />
      <div class="entries">
        {recentPosts.map((post, i) => (
          <BlogCard
            title={post.data.title}
            date={post.data.date}
            slug={post.id}
          />
        ))}
      </div>
    </section>

    <!-- Wave divider -->
    <div class="wave-sep" aria-hidden="true">
      <svg width="120" height="12" viewBox="0 0 120 12" fill="none">
        <path d="M0,6 Q15,1 30,6 Q45,11 60,6 Q75,1 90,6 Q105,11 120,6" stroke="currentColor" stroke-width="0.75" stroke-linecap="round"/>
      </svg>
    </div>

    <!-- Projects -->
    {featuredProjects.length > 0 && (
      <section class="home-section animate-fade-in-up" style="animation-delay: 0.2s;">
        <SectionHeader title="Projects" kanji="作品" href="/projects" />
        <div class="project-entries">
          {featuredProjects.map((project) => (
            <ProjectCard
              title={project.data.title}
              description={project.data.description}
              tags={project.data.tags}
              slug={project.id}
            />
          ))}
        </div>
      </section>
    )}

    <!-- Wave divider -->
    {recentNotes.length > 0 && (
      <div class="wave-sep" aria-hidden="true">
        <svg width="120" height="12" viewBox="0 0 120 12" fill="none">
          <path d="M0,6 Q15,1 30,6 Q45,11 60,6 Q75,1 90,6 Q105,11 120,6" stroke="currentColor" stroke-width="0.75" stroke-linecap="round"/>
        </svg>
      </div>
    )}

    <!-- Notes -->
    {recentNotes.length > 0 && (
      <section class="home-section animate-fade-in-up" style="animation-delay: 0.3s;">
        <SectionHeader title="Notes" kanji="手記" href="/notes" />
        <div class="note-entries">
          {recentNotes.map((note) => (
            <NoteEntry
              title={note.data.title}
              description={note.data.description}
              date={note.data.date}
              id={note.id}
            />
          ))}
        </div>
      </section>
    )}
  </div>
</Base>

<style>
  .home-content {
    max-width: 1060px;
    margin: 0 auto;
    padding: 0 1.5rem 6rem;
  }

  .home-section {
    margin-bottom: 1rem;
  }

  .entries {
    display: flex;
    flex-direction: column;
  }

  .project-entries {
    display: flex;
    flex-direction: column;
  }

  .note-entries {
    padding-top: 0.25rem;
  }

  .wave-sep {
    display: flex;
    justify-content: center;
    color: var(--color-border);
    opacity: 0.4;
    margin: 3.5rem 0;
  }
</style>
