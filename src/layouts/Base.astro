---
import { ViewTransitions } from "astro:transitions";
import "../styles/global.css";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import Search from "../components/Search.astro";

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Sam Duke — web developer, founder, builder on the edge." } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=JetBrains+Mono:wght@400;500&family=Noto+Serif+JP:wght@200;400&display=swap" />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=JetBrains+Mono:wght@400;500&family=Noto+Serif+JP:wght@200;400&display=swap" rel="stylesheet" />
    <title>{title} — Sam Duke</title>
    <ViewTransitions />
  </head>
  <body>
    <!-- SVG filter for washi paper grain texture -->
    <svg class="svg-defs" aria-hidden="true">
      <filter id="grain">
        <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/>
        <feColorMatrix type="saturate" values="0"/>
      </filter>
    </svg>

    <!-- Vertical side decoration -->
    <div class="side-text" aria-hidden="true">craft · code · 道</div>

    <Nav transition:persist />
    <main>
      <slot />
    </main>
    <Footer />
    <Search />
  </body>
</html>

<style>
  .svg-defs {
    position: absolute;
    width: 0;
    height: 0;
    overflow: hidden;
  }

  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background:
      radial-gradient(ellipse at 10% 0%, rgba(180, 45, 54, 0.04) 0%, transparent 50%),
      radial-gradient(ellipse at 90% 100%, rgba(30, 58, 92, 0.035) 0%, transparent 50%),
      var(--color-bg);
  }

  /* Decorative viewport frame — solid border masks content at edges */
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    border: 14px solid var(--color-bg);
    box-shadow: inset 0 0 0 1px rgba(180, 165, 145, 0.5);
    pointer-events: none;
    z-index: 50;
  }

  /* Washi paper grain overlay */
  body::after {
    content: "";
    position: fixed;
    inset: 0;
    z-index: 10000;
    pointer-events: none;
    filter: url(#grain);
    opacity: 0.05;
  }

  /* Vertical side text — runs down the right edge */
  .side-text {
    position: fixed;
    right: 22px;
    top: 50%;
    transform: translateY(-50%);
    writing-mode: vertical-rl;
    font-family: var(--font-mono);
    font-size: 0.55rem;
    letter-spacing: 0.35em;
    color: var(--color-border);
    opacity: 0.45;
    z-index: 50;
    pointer-events: none;
    user-select: none;
  }

  main {
    flex: 1;
    position: relative;
    z-index: 1;
    overflow: clip;
  }

  /* Disable stagger animations during view transitions */
  body.vt-nav :global(.animate-fade-in-up) {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
  }

  @media (max-width: 900px) {
    body::before {
      inset: 0;
      border-width: 10px;
    }
    .side-text {
      display: none;
    }
  }

  @media (max-width: 640px) {
    body::before {
      display: none;
    }
  }
</style>

<script>
  document.addEventListener("astro:after-swap", () => {
    document.body.classList.add("vt-nav");
    document.getElementById("main-nav")?.classList.remove("hidden");
  });
</script>
